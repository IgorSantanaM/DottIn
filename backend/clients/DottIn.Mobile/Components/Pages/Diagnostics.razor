@page "/diagnostics"
@inject IServiceProvider ServiceProvider
@inject NavigationManager Navigation

<div style="padding: 20px; font-family: monospace; background: #f5f5f5; height: 100vh; overflow: auto;">
    <h2>?? Diagnostic Information</h2>
    
    <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px;">
        <h3>? Blazor Status</h3>
        <p><strong>Component Initialized:</strong> Yes</p>
        <p><strong>Current URL:</strong> @Navigation.Uri</p>
        <p><strong>Base URL:</strong> @Navigation.BaseUri</p>
    </div>

    <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px;">
        <h3>?? Dependency Injection</h3>
        @foreach (var service in _serviceChecks)
        {
            <p>
                <span style="color: @(service.Value ? "green" : "red")">
                    @(service.Value ? "?" : "?")
                </span>
                <strong>@service.Key:</strong> @(service.Value ? "Registered" : "NOT FOUND")
            </p>
        }
    </div>

    <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px;">
        <h3>?? AppState</h3>
        @if (_appState != null)
        {
            <p><strong>IsAuthenticated:</strong> @_appState.IsAuthenticated</p>
            <p><strong>EmployeeId:</strong> @_appState.EmployeeId</p>
            <p><strong>BranchId:</strong> @_appState.BranchId</p>
            <p><strong>Employee:</strong> @(_appState.Employee?.Name ?? "null")</p>
        }
        else
        {
            <p style="color: red;">AppState is NULL</p>
        }
    </div>

    <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 8px;">
        <h3>?? Connectivity</h3>
        <p><strong>Connected:</strong> @_isConnected</p>
    </div>

    <div style="margin-top: 20px;">
        <button @onclick='() => Navigation.NavigateTo("/")' 
                style="padding: 10px 20px; background: #2563EB; color: white; border: none; border-radius: 8px; cursor: pointer;">
            Go to Home (/)
        </button>
        <button @onclick='() => Navigation.NavigateTo("/login")' 
                style="padding: 10px 20px; background: #2563EB; color: white; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px;">
            Go to Login
        </button>
        <button @onclick='() => Navigation.NavigateTo("/dashboard")' 
                style="padding: 10px 20px; background: #2563EB; color: white; border: none; border-radius: 8px; cursor: pointer; margin-left: 10px;">
            Go to Dashboard
        </button>
    </div>
</div>

@code {
    private Dictionary<string, bool> _serviceChecks = new();
    private AppState? _appState;
    private bool _isConnected;

    protected override void OnInitialized()
    {
        System.Diagnostics.Debug.WriteLine("=== Diagnostics page initialized ===");

        // Check services
        _serviceChecks["AppState"] = ServiceProvider.GetService<AppState>() != null;
        _serviceChecks["ISecureStorageService"] = ServiceProvider.GetService<ISecureStorageService>() != null;
        _serviceChecks["ILocationService"] = ServiceProvider.GetService<ILocationService>() != null;
        _serviceChecks["IConnectivityService"] = ServiceProvider.GetService<IConnectivityService>() != null;
        _serviceChecks["ILocalDatabaseService"] = ServiceProvider.GetService<ILocalDatabaseService>() != null;
        _serviceChecks["IAuthApi"] = ServiceProvider.GetService<IAuthApi>() != null;
        _serviceChecks["ITimeKeepingApi"] = ServiceProvider.GetService<ITimeKeepingApi>() != null;
        _serviceChecks["IEmployeeApi"] = ServiceProvider.GetService<IEmployeeApi>() != null;

        // Get AppState
        _appState = ServiceProvider.GetService<AppState>();

        // Get connectivity
        var connectivity = ServiceProvider.GetService<IConnectivityService>();
        _isConnected = connectivity?.IsConnected ?? false;
    }
}
